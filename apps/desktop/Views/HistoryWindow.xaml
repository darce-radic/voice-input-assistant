<Window x:Class="VoiceInputAssistant.Views.HistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Recognition History - Voice Input Assistant" 
        Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
        MinHeight="500" MinWidth="700"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Icon="../Assets/icon.ico">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Margin" Value="8,4"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
        </Style>
        
        <Style x:Key="DataTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="8,4"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style x:Key="FilterCardStyle" TargetType="materialDesign:Card">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="materialDesign:ShadowAssist.ShadowDepth" Value="Depth1"/>
        </Style>
        
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="materialDesign:ButtonAssist.CornerRadius" Value="4"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:ColorZone Grid.Row="0" 
                                  Mode="PrimaryMid" 
                                  Padding="20"
                                  materialDesign:ShadowAssist.ShadowDepth="Depth2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="History" 
                                           Width="24" 
                                           Height="24" 
                                           Margin="0,0,12,0"
                                           Foreground="White"/>
                    <TextBlock Text="Recognition History" 
                             FontSize="20" 
                             FontWeight="Medium" 
                             Foreground="White"
                             VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" 
                          Orientation="Horizontal"
                          VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="Information" 
                                           Width="16" 
                                           Height="16" 
                                           Margin="0,0,8,0"
                                           Foreground="White"
                                           ToolTip="View detailed transcription history"/>
                    <TextBlock Text="{Binding TotalCount, StringFormat='{}{0} total records'}" 
                             FontSize="12" 
                             Foreground="White"
                             VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </materialDesign:ColorZone>
        
        <!-- Filter Controls -->
        <Grid Grid.Row="1" Margin="20">
            <materialDesign:Card Style="{StaticResource FilterCardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Filter Header -->
                    <TextBlock Grid.Row="0" 
                             Text="Search &amp; Filter" 
                             Style="{StaticResource HeaderTextBlock}"
                             Margin="0,0,0,12"/>
                    
                    <!-- Filter Controls -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox Grid.Column="0" 
                               Name="FilterTextBox" 
                               Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                               materialDesign:HintAssist.Hint="Search transcriptions..."
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                               Margin="0,0,12,0"
                               VerticalAlignment="Center">
                            <TextBox.InputBindings>
                                <KeyBinding Key="Escape" Command="{Binding ClearFilterCommand}"/>
                            </TextBox.InputBindings>
                        </TextBox>
                        
                        <ComboBox Grid.Column="1" 
                                Name="EngineFilter"
                                SelectedItem="{Binding SelectedEngineFilter}"
                                ItemsSource="{Binding AvailableEngines}"
                                materialDesign:HintAssist.Hint="Filter by Engine"
                                materialDesign:HintAssist.IsFloating="True"
                                Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                Margin="6,0"
                                VerticalAlignment="Center"/>
                        
                        <ComboBox Grid.Column="2" 
                                Name="DateFilter"
                                SelectedItem="{Binding SelectedDateFilter}"
                                ItemsSource="{Binding AvailableDateFilters}"
                                materialDesign:HintAssist.Hint="Filter by Date"
                                materialDesign:HintAssist.IsFloating="True"
                                Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                Margin="6,0,12,0"
                                VerticalAlignment="Center"/>
                        
                        <Button Grid.Column="3" 
                              Style="{StaticResource MaterialDesignOutlinedButton}"
                              Command="{Binding ExportHistoryCommand}"
                              ToolTip="Export history to file (Ctrl+E)"
                              Margin="4,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Export" 
                                                       Width="16" 
                                                       Height="16" 
                                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Export"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Grid.Column="4" 
                              Style="{StaticResource MaterialDesignOutlinedButton}"
                              Command="{Binding ClearHistoryCommand}"
                              ToolTip="Clear all history (Ctrl+Delete)"
                              Margin="4,0,0,0"
                              Foreground="{DynamicResource ValidationErrorBrush}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Delete" 
                                                       Width="16" 
                                                       Height="16" 
                                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Clear"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </Grid>
            </materialDesign:Card>
        </Grid>
        
        <!-- Results List -->
        <Grid Grid.Row="2" Margin="20,0,20,20">
            <materialDesign:Card materialDesign:ShadowAssist.ShadowDepth="Depth1"
                               Padding="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Empty State -->
                    <Grid Grid.Row="1" 
                          Visibility="{Binding HasResults, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel VerticalAlignment="Center" 
                                  HorizontalAlignment="Center"
                                  Margin="40">
                            <materialDesign:PackIcon Kind="HistoryOff" 
                                                   Width="64" 
                                                   Height="64" 
                                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,0,0,16"/>
                            <TextBlock Text="No transcriptions found" 
                                     FontSize="18" 
                                     FontWeight="Medium"
                                     Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     HorizontalAlignment="Center"
                                     Margin="0,0,0,8"/>
                            <TextBlock Text="Start using voice recognition to see your history here" 
                                     FontSize="14" 
                                     Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     HorizontalAlignment="Center"
                                     TextAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Data List -->
                    <ListView Grid.Row="1" 
                            Name="HistoryListView"
                            ItemsSource="{Binding FilteredResults}"
                            SelectedItem="{Binding SelectedResult}"
                            Style="{StaticResource MaterialDesignListView}"
                            Visibility="{Binding HasResults, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Time" Width="140">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Clock" 
                                                                       Width="14" 
                                                                       Height="14" 
                                                                       Margin="0,0,4,0"/>
                                                <TextBlock Text="Time" FontWeight="Medium"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Timestamp, StringFormat='MM/dd/yyyy HH:mm:ss'}" 
                                                     Style="{StaticResource DataTextBlock}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Engine" Width="120">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Engine" 
                                                                       Width="14" 
                                                                       Height="14" 
                                                                       Margin="0,0,4,0"/>
                                                <TextBlock Text="Engine" FontWeight="Medium"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <materialDesign:Chip Content="{Binding Engine}" 
                                                               IconBackground="{DynamicResource PrimaryHueMidBrush}"
                                                               IconForeground="White"
                                                               Icon="Microphone"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Text" Width="400">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Text" 
                                                                       Width="14" 
                                                                       Height="14" 
                                                                       Margin="0,0,4,0"/>
                                                <TextBlock Text="Transcription" FontWeight="Medium"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Text}" 
                                                     Style="{StaticResource DataTextBlock}"
                                                     TextTrimming="CharacterEllipsis"
                                                     ToolTip="{Binding Text}"
                                                     MaxWidth="380"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Confidence" Width="100">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="CheckCircle" 
                                                                       Width="14" 
                                                                       Height="14" 
                                                                       Margin="0,0,4,0"/>
                                                <TextBlock Text="Confidence" FontWeight="Medium"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Width="16" Height="16" 
                                                                       Margin="0,0,4,0">
                                                    <materialDesign:PackIcon.Style>
                                                        <Style TargetType="materialDesign:PackIcon">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                                                    <Setter Property="Kind" Value="CheckCircle"/>
                                                                    <Setter Property="Foreground" Value="Green"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                                                    <Setter Property="Kind" Value="MinusCircle"/>
                                                                    <Setter Property="Foreground" Value="Orange"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Low">
                                                                    <Setter Property="Kind" Value="CloseCircle"/>
                                                                    <Setter Property="Foreground" Value="Red"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </materialDesign:PackIcon.Style>
                                                </materialDesign:PackIcon>
                                                <TextBlock Text="{Binding Confidence, StringFormat='{}{0:P0}'}" 
                                                         Style="{StaticResource DataTextBlock}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Processing" Width="110">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Timer" 
                                                                       Width="14" 
                                                                       Height="14" 
                                                                       Margin="0,0,4,0"/>
                                                <TextBlock Text="Time" FontWeight="Medium"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ProcessingTime, StringFormat='{}{0:F2}s'}" 
                                                     Style="{StaticResource DataTextBlock}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Actions" Width="80">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <materialDesign:PackIcon Kind="DotsVertical" 
                                                                   Width="14" 
                                                                   Height="14"/>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button Style="{StaticResource MaterialDesignToolButton}"
                                                      Width="24" Height="24"
                                                      Command="{Binding DataContext.CopyToClipboardCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                      CommandParameter="{Binding}"
                                                      ToolTip="Copy text to clipboard">
                                                    <materialDesign:PackIcon Kind="ContentCopy" Width="14" Height="14"/>
                                                </Button>
                                                <Button Style="{StaticResource MaterialDesignToolButton}"
                                                      Width="24" Height="24"
                                                      Command="{Binding DataContext.PlayAudioCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                      CommandParameter="{Binding}"
                                                      ToolTip="Play audio (if available)"
                                                      Visibility="{Binding HasAudio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <materialDesign:PackIcon Kind="Play" Width="14" Height="14"/>
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                        
                        <!-- Context Menu -->
                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Copy Text" 
                                        Command="{Binding CopyToClipboardCommand}"
                                        CommandParameter="{Binding SelectedResult}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="ContentCopy"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Reinsert Text" 
                                        Command="{Binding ReinsertTextCommand}"
                                        CommandParameter="{Binding SelectedResult}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="KeyboardReturn"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator/>
                                <MenuItem Header="Delete Entry" 
                                        Command="{Binding DeleteEntryCommand}"
                                        CommandParameter="{Binding SelectedResult}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="Delete"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </ListView.ContextMenu>
                    </ListView>
                    
                    <!-- Quick Stats -->
                    <materialDesign:ColorZone Grid.Row="2" 
                                            Mode="PrimaryLight" 
                                            Padding="16,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" 
                                     Text="{Binding StatusMessage}" 
                                     FontSize="12"
                                     VerticalAlignment="Center"/>
                            
                            <StackPanel Grid.Column="1" 
                                      Orientation="Horizontal" 
                                      Margin="12,0">
                                <materialDesign:PackIcon Kind="Counter" 
                                                       Width="14" 
                                                       Height="14" 
                                                       Margin="0,0,4,0"
                                                       VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding FilteredCount, StringFormat='{}{0} shown'}" 
                                         FontSize="12" 
                                         VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2" 
                                      Orientation="Horizontal" 
                                      Margin="12,0">
                                <materialDesign:PackIcon Kind="Speedometer" 
                                                       Width="14" 
                                                       Height="14" 
                                                       Margin="0,0,4,0"
                                                       VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding AverageProcessingTime, StringFormat='Avg: {0:F2}s'}" 
                                         FontSize="12" 
                                         VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="3" 
                                      Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="CheckCircle" 
                                                       Width="14" 
                                                       Height="14" 
                                                       Margin="0,0,4,0"
                                                       VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding AverageConfidence, StringFormat='Confidence: {0:P0}'}" 
                                         FontSize="12" 
                                         VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </materialDesign:ColorZone>
                </Grid>
            </materialDesign:Card>
        </Grid>
    </Grid>
</Window>